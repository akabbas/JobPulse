<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobPulse - Skills Network Visualization</title>
    
    <!-- Vis Network Library -->
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/skillsNetwork.css') }}">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #6c757d;
            font-size: 18px;
            margin: 0;
        }
        
        .demo-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }
        
        .demo-section h2 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .feature-card h3 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .feature-card p {
            color: #6c757d;
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .controls-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .control-group label {
            font-weight: 500;
            color: #495057;
            font-size: 14px;
        }
        
        .control-group select,
        .control-group input {
            padding: 8px 12px;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 14px;
            font-weight: 500;
        }
        
        .instructions {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .instructions h3 {
            color: #1976d2;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .instructions ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin: 8px 0;
            color: #1565c0;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .demo-section {
                padding: 20px;
            }
            
            .controls-section {
                flex-direction: column;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ JobPulse Skills Network</h1>
            <p>Interactive visualization of skill relationships in the job market</p>
        </div>
        
        <div class="demo-section">
            <h2>üéØ How It Works</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <h3>üìä Skill Nodes</h3>
                    <p>Each circle represents a skill, with size indicating how frequently it appears in job postings.</p>
                </div>
                <div class="feature-card">
                    <h3>üîó Skill Connections</h3>
                    <p>Lines between skills show how often they appear together in the same job descriptions.</p>
                </div>
                <div class="feature-card">
                    <h3>üé® Color Coding</h3>
                    <p>Colors indicate skill demand levels: Red (high), Orange (medium), Yellow (moderate), Green (lower).</p>
                </div>
                <div class="feature-card">
                    <h3>üñ±Ô∏è Interactive Features</h3>
                    <p>Click nodes to explore connections, hover for details, and drag to navigate the network.</p>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üéÆ Interactive Controls</h2>
            <div class="controls-section">
                <div class="control-group">
                    <label for="skill-filter">Filter by Skill:</label>
                    <select id="skill-filter">
                        <option value="">All Skills</option>
                        <option value="python">Python</option>
                        <option value="javascript">JavaScript</option>
                        <option value="react">React</option>
                        <option value="node.js">Node.js</option>
                        <option value="aws">AWS</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="min-frequency">Min Frequency:</label>
                    <input type="number" id="min-frequency" value="5" min="1" max="100">
                </div>
                
                <div class="control-group">
                    <label for="co-occurrence-threshold">Co-occurrence Threshold:</label>
                    <input type="number" id="co-occurrence-threshold" value="3" min="1" max="20">
                </div>
                
                <div class="control-group">
                    <button class="btn btn-success" onclick="applyFilters()">Apply Filters</button>
                </div>
                
                <div class="control-group">
                    <button class="btn btn-secondary" onclick="resetView()">Reset View</button>
                </div>
                
                <div class="control-group">
                    <button class="btn" onclick="refreshSkillsNetwork()">Refresh Data</button>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üìà Network Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-skills">-</div>
                    <div class="stat-label">Total Skills</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-connections">-</div>
                    <div class="stat-label">Skill Connections</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avg-frequency">-</div>
                    <div class="stat-label">Avg. Frequency</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="network-density">-</div>
                    <div class="stat-label">Network Density</div>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>üí° How to Use the Skills Network</h3>
            <ul>
                <li><strong>Zoom:</strong> Use mouse wheel or pinch gestures to zoom in/out</li>
                <li><strong>Pan:</strong> Click and drag to move around the network</li>
                <li><strong>Explore:</strong> Click on any skill node to see its connections highlighted</li>
                <li><strong>Details:</strong> Hover over nodes and edges to see tooltips with information</li>
                <li><strong>Reset:</strong> Double-click in empty space to reset the view</li>
                <li><strong>Filter:</strong> Use the controls above to filter skills by frequency and connections</li>
            </ul>
        </div>
        
        <div class="demo-section">
            <h2>üîç Skills Network Visualization</h2>
            <div id="skills-network"></div>
        </div>
    </div>
    
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/skillsNetwork.js') }}"></script>
    
    <script>
        // Global variables for the network
        let skillsNetworkInstance = null;
        let currentFilters = {
            skill: '',
            minFrequency: 5,
            coOccurrenceThreshold: 3
        };
        
        // Initialize the network when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for the container to be ready
            setTimeout(() => {
                skillsNetworkInstance = initializeSkillsNetwork('skills-network');
                if (skillsNetworkInstance) {
                    // Update statistics after network is loaded
                    setTimeout(updateStatistics, 2000);
                }
            }, 100);
        });
        
        // Apply filters to the network
        function applyFilters() {
            const skillFilter = document.getElementById('skill-filter').value;
            const minFreq = parseInt(document.getElementById('min-frequency').value);
            const coOccThreshold = parseInt(document.getElementById('co-occurrence-threshold').value);
            
            currentFilters = {
                skill: skillFilter,
                minFrequency: minFreq,
                coOccurrenceThreshold: coOccThreshold
            };
            
            // Apply filters to the network
            if (skillsNetworkInstance) {
                applyNetworkFilters();
            }
            
            console.log('Filters applied:', currentFilters);
        }
        
        // Apply filters to the network visualization
        function applyNetworkFilters() {
            if (!skillsNetworkInstance || !skillsNetworkInstance.skillsData) return;
            
            const { skills, co_occurrences } = skillsNetworkInstance.skillsData.data;
            
            // Clear current nodes and edges
            skillsNetworkInstance.nodes.clear();
            skillsNetworkInstance.edges.clear();
            
            // Filter skills by frequency
            const filteredSkills = {};
            Object.entries(skills).forEach(([skill, freq]) => {
                if (freq >= currentFilters.minFrequency) {
                    if (!currentFilters.skill || skill.toLowerCase().includes(currentFilters.skill.toLowerCase())) {
                        filteredSkills[skill] = freq;
                    }
                }
            });
            
            // Filter co-occurrences by threshold
            const filteredCoOccurrences = {};
            Object.entries(co_occurrences).forEach(([pair, count]) => {
                if (count >= currentFilters.coOccurrenceThreshold) {
                    const [skill1, skill2] = pair.split('|');
                    if (filteredSkills[skill1] && filteredSkills[skill2]) {
                        filteredCoOccurrences[pair] = count;
                    }
                }
            });
            
            // Recreate the network with filtered data
            skillsNetworkInstance.createNodes(filteredSkills);
            skillsNetworkInstance.createEdges(filteredCoOccurrences);
            skillsNetworkInstance.network.fit();
            
            // Update statistics
            updateStatistics();
        }
        
        // Reset the network view
        function resetView() {
            if (skillsNetworkInstance && skillsNetworkInstance.network) {
                skillsNetworkInstance.network.fit();
                
                // Reset filters
                document.getElementById('skill-filter').value = '';
                document.getElementById('min-frequency').value = 5;
                document.getElementById('co-occurrence-threshold').value = 3;
                
                currentFilters = {
                    skill: '',
                    minFrequency: 5,
                    coOccurrenceThreshold: 3
                };
                
                // Reload original data
                if (skillsNetworkInstance.skillsData) {
                    skillsNetworkInstance.nodes.clear();
                    skillsNetworkInstance.edges.clear();
                    skillsNetworkInstance.createNodes(skillsNetworkInstance.skillsData.data.skills);
                    skillsNetworkInstance.createEdges(skillsNetworkInstance.skillsData.data.co_occurrences);
                    skillsNetworkInstance.network.fit();
                }
                
                updateStatistics();
            }
        }
        
        // Update network statistics
        function updateStatistics() {
            if (!skillsNetworkInstance || !skillsNetworkInstance.skillsData) return;
            
            const { skills, co_occurrences } = skillsNetworkInstance.skillsData.data;
            
            // Calculate statistics
            const totalSkills = Object.keys(skills).length;
            const totalConnections = Object.keys(co_occurrences).length;
            const avgFrequency = Math.round(Object.values(skills).reduce((a, b) => a + b, 0) / totalSkills);
            const networkDensity = totalConnections > 0 ? Math.round((totalConnections / (totalSkills * (totalSkills - 1) / 2)) * 100) / 100 : 0;
            
            // Update display
            document.getElementById('total-skills').textContent = totalSkills;
            document.getElementById('total-connections').textContent = totalConnections;
            document.getElementById('avg-frequency').textContent = avgFrequency;
            document.getElementById('network-density').textContent = networkDensity;
        }
        
        // Add some sample data for demonstration (remove this in production)
        function addSampleData() {
            // This would normally come from your Flask API
            const sampleData = {
                success: true,
                data: {
                    skills: {
                        'Python': 45,
                        'JavaScript': 38,
                        'React': 32,
                        'Node.js': 28,
                        'AWS': 25,
                        'Docker': 22,
                        'Kubernetes': 18,
                        'PostgreSQL': 20,
                        'MongoDB': 16,
                        'Redis': 14,
                        'GraphQL': 12,
                        'TypeScript': 15,
                        'Vue.js': 10,
                        'Angular': 8,
                        'Go': 6,
                        'Rust': 4
                    },
                    co_occurrences: {
                        'Python|JavaScript': 15,
                        'Python|React': 8,
                        'Python|Node.js': 12,
                        'JavaScript|React': 25,
                        'JavaScript|Node.js': 20,
                        'React|Node.js': 18,
                        'AWS|Docker': 12,
                        'Docker|Kubernetes': 10,
                        'PostgreSQL|MongoDB': 6,
                        'Redis|PostgreSQL': 8,
                        'GraphQL|Node.js': 7,
                        'TypeScript|React': 12,
                        'Vue.js|JavaScript': 6,
                        'Angular|TypeScript': 5,
                        'Go|Docker': 3,
                        'Rust|Docker': 2
                    }
                }
            };
            
            // Store sample data for demonstration
            if (skillsNetworkInstance) {
                skillsNetworkInstance.skillsData = sampleData;
                skillsNetworkInstance.createNetwork();
                updateStatistics();
            }
        }
        
        // Add sample data after a delay for demonstration
        setTimeout(addSampleData, 3000);
    </script>
</body>
</html>
